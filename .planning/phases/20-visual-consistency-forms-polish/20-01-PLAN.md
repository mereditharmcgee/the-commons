# Plan 20-01: CSS Additions & Modal Keyboard Accessibility

---
wave: 1
depends_on: []
files_modified:
  - css/style.css
  - js/discussion.js
autonomous: true
requirements: [VIS-08, RESP-01, RESP-03]
---

## Goal

Add new CSS modifier classes (textarea heights, postcard-acrostic color variable, postcard format border CSS variables, modal close button focus-visible styling) and fix modal keyboard accessibility (auto-focus close button on open, Escape key to close). These CSS classes and JS fixes must exist before Plan 20-04 applies them to HTML pages.

## Context

### VIS-08: Postcard format borders use hardcoded hex
- style.css lines 2301-2314: `.postcard--haiku` (#a78bfa), `--six-words` (#6ee7b7), `--first-last` (#60a5fa), `--acrostic` (#f472b6)
- Map to CSS variables: --gemini-color, --gpt-color, --llama-color, and a new --postcard-acrostic-color
- Decision: use existing model color vars where they match, introduce a CSS variable for acrostic pink

### RESP-01: Modal close button focus-visible and keyboard accessibility
- `.modal__close` (style.css line 3485) has no focus-visible styling
- Add to the existing focus-visible selector group
- Per 20-CONTEXT.md locked decisions:
  - Auto-focus the close button when a modal opens so keyboard users can immediately dismiss it
  - Escape key should close modals (if not already implemented)
- dashboard.js modals already have: Escape key handler (global handler at line 108-117), auto-focus on open (identity modal focuses identityName at line 262, token modal focuses tokenIdentitySelect at line 730), and focus trapping
- discussion.js edit-post-modal (line 526) has NO Escape key handler and NO auto-focus on open — this is the modal that needs JS fixes

### RESP-03: Inline textarea min-height overrides
- suggest-text.html has two textareas with inline `style="min-height: 300px;"` and `style="min-height: 100px;"`
- postcards.html has one textarea with `style="min-height: 100px;"`
- Add `.form-textarea--tall` (300px) and `.form-textarea--compact` (100px) CSS modifier classes

## Tasks

<task id="20-01-01">
<title>Add CSS modifier classes for textarea heights and postcard-acrostic color variable</title>
<steps>
1. In css/style.css, after the `.form-textarea` rule (line ~1083), add:
   - `.form-textarea--compact { min-height: 100px; }`
   - `.form-textarea--tall { min-height: 300px; }`
2. In css/style.css :root block, add: `--postcard-acrostic-color: #f472b6;`
3. Replace hard-coded hex in postcard format borders:
   - `.postcard--haiku`: `#a78bfa` → `var(--gemini-color)`
   - `.postcard--six-words`: `#6ee7b7` → `var(--gpt-color)`
   - `.postcard--first-last`: `#60a5fa` → `var(--llama-color)`
   - `.postcard--acrostic`: `#f472b6` → `var(--postcard-acrostic-color)`
</steps>
</task>

<task id="20-01-02">
<title>Add modal close button focus-visible styling</title>
<steps>
1. In css/style.css, add `.modal__close:focus-visible` to the existing focus-visible selector group (lines 1509-1517):
   - Add `.modal__close:focus-visible,` to the selector list
   - This gives it `outline: 2px solid var(--accent-gold); outline-offset: 2px;`
</steps>
</task>

<task id="20-01-03">
<title>Add auto-focus and Escape key handler to discussion.html edit-post modal</title>
<steps>
1. In js/discussion.js, in the block that opens the edit modal (line ~526, where `classList.remove('hidden')` is called), add auto-focus on the close button immediately after showing the modal:
   ```js
   document.getElementById('edit-post-modal').classList.remove('hidden');
   // Auto-focus close button for keyboard accessibility (RESP-01)
   const closeBtn = document.querySelector('#edit-post-modal .modal__close');
   if (closeBtn) closeBtn.focus();
   ```
2. In js/discussion.js, add an Escape key handler. Near the modal open/close functions (after the closeEditModal function around line 532), add:
   ```js
   // Escape key closes edit modal (RESP-01)
   document.addEventListener('keydown', (e) => {
       if (e.key === 'Escape') {
           const modal = document.getElementById('edit-post-modal');
           if (modal && !modal.classList.contains('hidden')) {
               closeEditModal();
           }
       }
   });
   ```
3. Note: dashboard.js modals already have Escape handling (global handler at line 108) and auto-focus (identityName/tokenIdentitySelect) — no changes needed there
</steps>
</task>

## Verification

- [ ] `.form-textarea--compact` and `.form-textarea--tall` classes exist in style.css
- [ ] Postcard format border colors use CSS variables, no hardcoded hex
- [ ] `--postcard-acrostic-color` variable defined in :root
- [ ] `.modal__close:focus-visible` selector exists in style.css with gold outline
- [ ] discussion.js: opening edit-post-modal auto-focuses the close button
- [ ] discussion.js: pressing Escape while edit-post-modal is visible closes it
- [ ] dashboard.js modals unchanged (already have Escape + focus management)

## must_haves
- Textarea height modifier CSS classes exist (.form-textarea--compact, .form-textarea--tall)
- Postcard format borders use CSS variables instead of hardcoded hex
- Modal close button has focus-visible outline
- Edit-post modal auto-focuses close button on open
- Escape key closes the edit-post modal
