---
phase: 18-dashboard-bug-fixes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - css/style.css
  - dashboard.html
autonomous: true
requirements:
  - DASH-01
  - DASH-08
  - DASH-09
  - DASH-10

must_haves:
  truths:
    - "Identity cards display vertically with header, bio, pin, and footer stacked top-to-bottom"
    - "Identity modal form content has single-layer padding, not double"
    - "Notification section occupies the wider grid column, not the narrow 300px column"
    - "No dead #not-logged-in markup exists in dashboard.html"
  artifacts:
    - path: "css/style.css"
      provides: "Fixed .identity-card flex-direction, removed double-padding rule, corrected grid positions"
      contains: "flex-direction: column"
    - path: "dashboard.html"
      provides: "Clean HTML without dead #not-logged-in div"
  key_links:
    - from: "css/style.css"
      to: "dashboard.html"
      via: ".identity-card class"
      pattern: "identity-card"
    - from: "css/style.css"
      to: "dashboard.html"
      via: ".dashboard-grid layout"
      pattern: "dashboard-grid"
---

<objective>
Fix CSS layout bugs and remove dead HTML markup from dashboard.html.

Purpose: Identity cards are visually broken (collapsed horizontal row), the modal has double padding, notifications are crammed into the narrow column, and dead HTML wastes bytes.
Output: Correctly laid-out identity cards, single-padded modal, better grid placement, cleaner HTML.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@css/style.css
@dashboard.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix identity card layout, modal padding, and grid placement in CSS</name>
  <files>css/style.css</files>
  <action>
Make three targeted CSS changes:

1. **DASH-01 — Identity card flex direction** (around line 3006):
   Change `.identity-card` from:
   ```css
   .identity-card {
       display: flex;
       align-items: center;
       gap: var(--space-md);
       ...
   }
   ```
   To:
   ```css
   .identity-card {
       display: flex;
       flex-direction: column;
       align-items: stretch;
       gap: var(--space-md);
       ...
   }
   ```
   The JS renders vertical block children (header div, bio paragraph, pin div, footer div), so the card must stack them vertically. Keep all other properties unchanged.

2. **DASH-08 — Double padding on identity modal** (around line 3483):
   Remove or comment out the `.modal__content form` rule:
   ```css
   /* Form inside modal */
   .modal__content form {
       padding: var(--space-lg);
   }
   ```
   The identity form element has class `modal__body` which already applies `padding: var(--space-lg)` (line 3478). This second rule causes double padding. Delete the `.modal__content form` rule entirely (lines 3482-3485). Keep the `.modal__content .form-group` rule that follows it.

3. **DASH-09 — Dashboard grid column assignment** (around line 2812):
   The current grid is `grid-template-columns: 1fr 300px` with no explicit placement, so content-heavy notifications (the second section in DOM order) falls into the narrow 300px column. Fix by assigning explicit grid positions. After the existing `.dashboard-grid` rule, add placement rules:
   ```css
   .dashboard-section--identities {
       grid-column: 1;
       grid-row: 1;
   }
   .dashboard-section--notifications {
       grid-column: 1;
       grid-row: 2;
   }
   .dashboard-section--subscriptions {
       grid-column: 2;
       grid-row: 1;
   }
   .dashboard-section--stats {
       grid-column: 2;
       grid-row: 2;
   }
   ```
   This places identities and notifications (content-heavy) in the wide 1fr column, and subscriptions and stats (lighter) in the narrow 300px column. The tokens section already has `grid-column: 1 / -1` (line 4180) spanning full width.
  </action>
  <verify>
    <automated>cd C:/Users/mmcge/the-commons && grep -n "flex-direction: column" css/style.css | grep -q "identity-card" && echo "DASH-01 OK" && ! grep -q "\.modal__content form" css/style.css && echo "DASH-08 OK" && grep -q "dashboard-section--notifications" css/style.css && echo "DASH-09 OK"</automated>
  </verify>
  <done>Identity cards use flex-direction: column + align-items: stretch. The .modal__content form double-padding rule is removed. Dashboard grid sections have explicit column/row assignments placing notifications in the wide column.</done>
</task>

<task type="auto">
  <name>Task 2: Remove dead #not-logged-in markup from dashboard.html</name>
  <files>dashboard.html</files>
  <action>
**DASH-10 — Remove dead #not-logged-in div:**
Delete the entire "Not Logged In State" block (lines 71-75 in current file):
```html
<!-- Not Logged In State -->
<div id="not-logged-in" class="dashboard-not-logged-in" style="display: none;">
    <h1 class="page-title">Dashboard</h1>
    <p class="text-muted mb-lg">You need to be logged in to view your dashboard.</p>
    <a href="login.html" class="btn btn--primary">Sign In</a>
</div>
```

This div is never shown because `js/dashboard.js` always redirects to `login.html?reason=session_expired` when not logged in (line 127). The `_notLoggedIn` variable in JS references it but is never used (prefixed with underscore indicating intentional disuse). Also remove the `_notLoggedIn` variable declaration from `js/dashboard.js` (line 7: `const _notLoggedIn = document.getElementById('not-logged-in');`).

Do NOT update the CSP hashes in the HTML head — the inline script hashes are for other script blocks, not for this markup.
  </action>
  <verify>
    <automated>cd C:/Users/mmcge/the-commons && ! grep -q "not-logged-in" dashboard.html && ! grep -q "_notLoggedIn" js/dashboard.js && echo "DASH-10 OK"</automated>
  </verify>
  <done>The #not-logged-in div is removed from dashboard.html and the unused _notLoggedIn variable is removed from dashboard.js. No other references to this dead code remain.</done>
</task>

</tasks>

<verification>
- Open dashboard.html in browser while logged in
- Identity cards should stack vertically (header on top, bio below, pin below that, footer at bottom)
- Notifications section should be in the wider left column, not the narrow right column
- Identity modal should have consistent padding (no extra space around form)
- View source: no #not-logged-in div present
</verification>

<success_criteria>
- .identity-card has flex-direction: column and align-items: stretch in CSS
- .modal__content form padding rule is deleted
- Dashboard grid sections have explicit grid-column/grid-row assignments
- #not-logged-in div removed from HTML, _notLoggedIn removed from JS
</success_criteria>

<output>
After completion, create `.planning/phases/18-dashboard-bug-fixes/18-01-SUMMARY.md`
</output>
