---
phase: 03-dead-code-links
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - admin.html
autonomous: true
requirements: [STRC-08]

must_haves:
  truths:
    - "No HTML file contains commented-out markup blocks left from previous iterations"
    - "Every HTML page loads the correct set of JS files for its functionality"
    - "admin.html loads utils.js so that admin.js Utils.getModelClass() calls work"
    - "No HTML file contains orphaned elements (IDs/classes referenced by no JS or CSS)"
  artifacts:
    - path: "admin.html"
      provides: "Admin page with utils.js and auth.js script tags added"
      contains: "src=\"js/utils.js\""
  key_links:
    - from: "admin.html"
      to: "js/utils.js"
      via: "script tag"
      pattern: "src=\"js/utils\\.js\""
    - from: "js/admin.js"
      to: "Utils.getModelClass"
      via: "function call"
      pattern: "Utils\\.getModelClass"
---

<objective>
Audit all HTML files for dead code (commented-out blocks, orphaned elements, missing script dependencies) and fix the admin.html script tag gap.

Purpose: Ensure every HTML page is clean of leftover markup and has correct script dependencies, so no page silently fails due to missing JS.
Output: admin.html fixed with utils.js dependency, all HTML files audited for dead markup.
</objective>

<execution_context>
@C:/Users/mmcge/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/mmcge/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-dead-code-links/03-RESEARCH.md

<interfaces>
<!-- Research confirmed findings for HTML audit -->

Script dependency gap (confirmed by research):
- admin.html loads only config.js + admin.js
- admin.js calls Utils.getModelClass() on lines 434, 486, 536, 750, 819
- admin.html must add utils.js (and auth.js if needed) script tags before admin.js

Standard script loading order (used by all other data pages):
1. config.js (provides CONFIG object)
2. utils.js (provides Utils object)
3. auth.js (provides Auth object)
4. page-specific.js (page logic)

Script tag inventory (from research — confirmed clean except admin.html):
- Every JS file in js/ is loaded by exactly one HTML page (matching the page's function)
- config.js, utils.js, auth.js are loaded as shared dependencies on all pages EXCEPT admin.html
- admin.html only loads config.js + admin.js (missing utils.js and auth.js)
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix admin.html script dependencies and audit all HTML for dead markup</name>
  <files>admin.html</files>
  <action>
    1. Fix admin.html script tags:
       - Read admin.html and find the script tag section
       - Add utils.js script tag AFTER config.js and BEFORE admin.js, following the standard load order: config.js → utils.js → auth.js → admin.js
       - Also add auth.js if admin.js uses any Auth.* calls (check admin.js for Auth references first)
       - Match the exact script tag format used in other pages (e.g., `<script src="js/utils.js"></script>`)

    2. Audit all 27 HTML files for commented-out HTML blocks:
       - Search all HTML files for `<!--` comment blocks
       - Distinguish between:
         a) Legitimate comments (section headers, license notices, conditional IE tags) — KEEP
         b) Commented-out markup from previous iterations (old nav items, disabled features, old script tags) — REMOVE
       - If any commented-out markup is found, remove it and add the file to the commit

    3. Audit for orphaned state containers left from Phase 2:
       - Phase 2 (02-02, 02-03, 02-04) replaced many ad-hoc state containers with Utils.showLoading/showError/showEmpty
       - Check if any HTML files still have elements with IDs like `errorState`, `loadingState`, `emptyState` that are no longer referenced by JS
       - Research confirmed script tag inventory is clean, so focus on element-level orphans

    4. Verify script tag inventory is complete:
       - For each HTML page that loads a page-specific JS file, confirm that file exists in js/
       - For each JS file in js/, confirm at least one HTML page loads it
       - This is a verification step, not expected to find issues (research confirmed clean)

    IMPORTANT: Only modify files where actual dead code is found. Do NOT reformat or restructure HTML files that are clean. The admin.html fix is the only confirmed change; the audit may find zero additional issues.
  </action>
  <verify>
    <automated>grep -c "src=\"js/utils.js\"" admin.html | grep -q "1" && echo "PASS: utils.js loaded" || echo "FAIL: utils.js missing"</automated>
  </verify>
  <done>
    - admin.html loads utils.js (and auth.js if admin.js needs it) in correct order before admin.js
    - All 27 HTML files audited for commented-out markup — any found is removed
    - No orphaned state container elements remain from Phase 2 refactoring
    - Script tag inventory verified: every JS file is loaded, every loaded file exists
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify all inter-page navigation links in HTML files</name>
  <files></files>
  <action>
    1. Run linkinator against the local HTML files to check all static href links:
       ```
       npx linkinator . --recurse --skip "^https://" --skip "^http://" --skip "^mailto:" --verbosity info
       ```
       This checks only internal links (skips external URLs for speed).

    2. If linkinator reports any broken internal links (non-200 status), investigate each:
       - Determine if the target file exists
       - If the file was renamed, fix the href to point to the correct file
       - If the page was intentionally removed, remove the link

    3. As a supplement, grep all HTML files for href values and verify each .html target exists:
       ```
       grep -oh 'href="[^"]*\.html[^"]*"' *.html | sort -u
       ```
       Cross-reference each unique href target against the list of HTML files in the project root.

    4. Check for any pages not reachable from index.html (orphan pages):
       - admin.html, reset-password.html, claim.html may not be linked from the main nav
       - These are intentionally unlinked (admin access, direct URL access) — document but do not change

    NOTE: linkinator may produce 403 errors for external URLs like ko-fi.com (bot protection) — these are expected and not broken links. Focus only on internal .html links.
    NOTE: This task makes no file modifications unless broken links are found in HTML files. The JS broken link (identity.html) is handled in Plan 01.
  </action>
  <verify>
    <automated>npx linkinator . --recurse --skip "^https://" --skip "^http://" --skip "^mailto:" 2>&1 | grep -c "BROKEN" | grep -q "^0$" && echo "PASS: no broken links" || echo "FAIL: broken links found"</automated>
  </verify>
  <done>
    - linkinator reports zero broken internal links
    - All href values in HTML files resolve to existing pages
    - Any orphan pages (not linked from nav) are documented as intentional
  </done>
</task>

</tasks>

<verification>
1. `grep -c 'src="js/utils.js"' admin.html` — returns 1
2. `npx linkinator . --recurse --skip "^https://" --skip "^http://" --skip "^mailto:"` — zero broken internal links
3. `grep -rn '<!--' *.html | grep -v "section\|license\|DOCTYPE\|IE\|endif\|Content-Security" | head -20` — review for any remaining commented-out markup (expected: only legitimate comments)
4. Script inventory check: every JS file in js/ is loaded by at least one HTML page
</verification>

<success_criteria>
- admin.html correctly loads utils.js before admin.js
- Zero commented-out markup blocks remain in any HTML file
- Zero orphaned state container elements remain from Phase 2
- linkinator confirms zero broken internal links across all pages
- Script tag inventory is complete: every JS file loaded, every loaded file exists
</success_criteria>

<output>
After completion, create `.planning/phases/03-dead-code-links/03-02-SUMMARY.md`
</output>
