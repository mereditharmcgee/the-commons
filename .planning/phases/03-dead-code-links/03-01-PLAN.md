---
phase: 03-dead-code-links
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - eslint.config.mjs
  - js/admin.js
  - js/chat.js
  - js/dashboard.js
  - js/profile.js
  - js/submit.js
  - js/text.js
  - js/utils.js
autonomous: true
requirements: [STRC-07, STRC-09]

must_haves:
  truths:
    - "No JS file contains unused local variables that are assigned but never read"
    - "No JS file contains unreachable code after return/throw/break statements"
    - "Every .html reference in JS template literals resolves to an existing HTML file"
    - "ESLint runs clean with zero warnings on all 21 JS files"
  artifacts:
    - path: "eslint.config.mjs"
      provides: "ESLint flat config for script-mode JS with IIFE pattern"
      contains: "sourceType.*script"
    - path: "js/admin.js"
      provides: "Admin panel JS with dead isAdmin variable removed and identity.html link fixed"
    - path: "js/profile.js"
      provides: "Profile JS with dead discussionIds variable removed"
    - path: "js/text.js"
      provides: "Text JS with dead nameDisplay variable removed"
  key_links:
    - from: "js/admin.js"
      to: "profile.html"
      via: "href in View Profile link template literal"
      pattern: "profile\\.html\\?id="
---

<objective>
Remove all dead JS code (unused variables, unreachable branches) and fix broken .html references in JS files.

Purpose: Eliminate dead code that confuses future maintainers and fix the one confirmed broken internal link so the admin panel's "View Profile" link works correctly.
Output: Clean ESLint run (zero warnings), 3 dead variables removed, 8 unused catch/event params cleaned up, 1 broken link fixed, eslint.config.mjs committed for ongoing use.
</objective>

<execution_context>
@C:/Users/mmcge/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/mmcge/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-dead-code-links/03-RESEARCH.md

<interfaces>
<!-- ESLint findings verified by research — these are the exact locations to fix -->

Dead variables (genuinely unused — remove entirely):
- js/admin.js:20 — `isAdmin` is assigned in 3 places but never read
- js/profile.js:160 — `discussionIds` is built from a map but the result is never consumed
- js/text.js:128 — `nameDisplay` is built but never consumed

Unused catch/event parameters (style fix — prefix with underscore):
- js/chat.js:265 — catch (e) where e is unused
- js/chat.js:585 — catch (e) where e is unused
- js/dashboard.js:446 — catch (e) where e is unused
- js/dashboard.js:454 — catch (e) where e is unused
- js/dashboard.js:742 — catch (error) where error is unused
- js/dashboard.js:777 — catch (error) where error is unused
- js/submit.js:60 — event param (e) unused
- js/submit.js:107 — event param (e) unused
- js/utils.js:87 — catch (e) where e is unused
- js/utils.js:822 — catch (e) where e is unused

Broken link (confirmed by research):
- js/admin.js:754 — href="identity.html?id=${identity.id}" should be href="profile.html?id=${identity.id}"
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ESLint config and fix all 13 dead code findings</name>
  <files>
    eslint.config.mjs
    js/admin.js
    js/chat.js
    js/dashboard.js
    js/profile.js
    js/submit.js
    js/text.js
    js/utils.js
  </files>
  <action>
    1. Create `eslint.config.mjs` at project root with the verified config from research:
       - files: ["js/**/*.js"]
       - languageOptions: ecmaVersion 2020, sourceType "script"
       - globals: window, document, console, fetch, URL, URLSearchParams, CONFIG, Auth, Utils, AgentAdmin, supabase, setTimeout, clearTimeout, setInterval, clearInterval, Promise, JSON, Error, Date, Math, parseInt, parseFloat, isNaN, Infinity, AbortController, FormData, alert, confirm, location, history, encodeURIComponent, decodeURIComponent, btoa, atob, Map, Set, Array, Object, Number, String, Boolean, Symbol, RegExp, DOMPurify, marked (all readonly)
       - rules: "no-unused-vars" ["warn", { "vars": "local", "args": "none" }], "no-unreachable" "warn"

    2. Remove dead variables (3 findings):
       - js/admin.js:20 — Remove `let isAdmin = false;` declaration AND all assignments to it (search for `isAdmin = true` and `isAdmin = false` assignments throughout the file). Since it is never READ, removing it and its assignments is safe. Be careful: search the entire file for all occurrences of `isAdmin` to confirm none are reads.
       - js/profile.js:160 — Remove `const discussionIds = ...` line. The `.map()` it calls has no side effects (it just extracts IDs), so removing the assignment is safe.
       - js/text.js:128 — Remove `const nameDisplay = ...` line. Verify the right-hand side has no side effects before removing.

    3. Rename unused catch/event params to underscore prefix (8 findings):
       - js/chat.js:265 — `catch (e)` → `catch (_e)`
       - js/chat.js:585 — `catch (e)` → `catch (_e)`
       - js/dashboard.js:446 — `catch (e)` → `catch (_e)`
       - js/dashboard.js:454 — `catch (e)` → `catch (_e)`
       - js/dashboard.js:742 — `catch (error)` → `catch (_error)`
       - js/dashboard.js:777 — `catch (error)` → `catch (_error)`
       - js/submit.js:60 — event param `(e)` → `(_e)` (only if the param is truly unused in the handler body)
       - js/submit.js:107 — event param `(e)` → `(_e)` (only if the param is truly unused in the handler body)
       - js/utils.js:87 — `catch (e)` → `catch (_e)`
       - js/utils.js:822 — `catch (e)` → `catch (_e)`

    4. Run `npx eslint js/` and verify zero warnings. If new findings appear (line numbers may have shifted from Phase 2 changes), fix them using the same patterns above.

    IMPORTANT: Line numbers from research may have shifted slightly due to Phase 2 modifications. Use the variable/function NAMES to locate the correct lines, not just line numbers. Read each file before editing.
  </action>
  <verify>
    <automated>npx eslint js/ 2>&1 | grep -c "warning" | grep -q "^0$" && echo "PASS: zero warnings" || echo "FAIL: warnings remain"</automated>
  </verify>
  <done>
    - `npx eslint js/` produces zero warnings
    - `isAdmin` variable and all its assignments removed from admin.js
    - `discussionIds` variable removed from profile.js
    - `nameDisplay` variable removed from text.js
    - All unused catch/event params prefixed with underscore
    - eslint.config.mjs committed at project root
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix broken identity.html link in admin.js and verify all JS-rendered hrefs</name>
  <files>js/admin.js</files>
  <action>
    1. Fix the confirmed broken link in js/admin.js:
       - Find `identity.html` (around line 754, may have shifted) and replace with `profile.html`
       - The full string is: `href="identity.html?id=${identity.id}"` → `href="profile.html?id=${identity.id}"`

    2. Grep all JS files for `.html` references in template literals to verify every referenced page exists:
       ```
       grep -rn '\.html' js/*.js | grep -v 'http' | grep -v '^//' | grep -v node_modules
       ```
       For each .html filename found, verify the file exists in the project root. The expected pages are documented in CLAUDE.md (26 HTML files).

    3. Also check docs/sops/POST_CLAIMS_SOP.md for the same `identity.html` reference noted in research — fix to `profile.html` if found.

    IMPORTANT: Do NOT modify any other links unless they are confirmed broken (target file does not exist). Functional links to existing pages must not be changed.
  </action>
  <verify>
    <automated>grep -rn "identity\.html" js/*.js docs/ 2>&1 | grep -c "identity" | grep -q "^0$" && echo "PASS: no identity.html refs" || echo "FAIL: identity.html refs remain"</automated>
  </verify>
  <done>
    - Zero references to `identity.html` remain in JS files or docs
    - `admin.js` links to `profile.html?id=` instead of `identity.html?id=`
    - All .html references in JS template literals resolve to existing HTML files
  </done>
</task>

</tasks>

<verification>
1. `npx eslint js/` — zero warnings, zero errors
2. `grep -rn "identity\.html" js/ docs/` — zero matches
3. `grep -rn "isAdmin" js/admin.js` — zero matches
4. `grep -rn "discussionIds" js/profile.js` — zero matches
5. `grep -rn "nameDisplay" js/text.js` — zero matches
6. Manual spot-check: open admin.js, search for `profile.html?id=` — should exist where identity.html was
</verification>

<success_criteria>
- ESLint produces zero warnings across all 21 JS files
- All 3 dead variables fully removed (no assignments or declarations remain)
- All 10 unused params renamed with underscore prefix
- Broken identity.html link fixed to profile.html in admin.js
- No JS file references a non-existent HTML page
- eslint.config.mjs exists at project root for future use
</success_criteria>

<output>
After completion, create `.planning/phases/03-dead-code-links/03-01-SUMMARY.md`
</output>
