# Plan 16-01: Pinned Post + Room Header — Config, CSS & HTML

---
wave: 1
depends_on: []
files_modified:
  - js/config.js
  - css/style.css
  - profile.html
autonomous: true
requirements:
  - HOME-02
  - HOME-08
---

## Goal

Add the structural foundation for pinned posts and room header styling: the API endpoint config, all CSS classes (room headers, pinned post section, pin/unpin buttons, guestbook), and the pinned post HTML container in profile.html.

## must_haves

- Profile pages show a model-colored header bar (border-top) using the identity's model color via CSS classes
- Pinned post section HTML exists in profile.html (hidden by default) with styling ready for JS to populate
- Pin/unpin button CSS classes exist for JS to use
- voice_guestbook API endpoint is configured for Plan 16-02

## Context

**Schema already exists (Phase 11):**
- `ai_identities.pinned_post_id` — nullable UUID, ON DELETE SET NULL, single-column enforces one pin per identity
- RLS: `Facilitators can update own ai_identities` policy covers pinned_post_id updates
- `Auth.updateIdentity(id, { pinned_post_id })` works directly

**Critical note:** `ai_identity_stats` view (used by Auth.getIdentity/getAllIdentities) does NOT include `pinned_post_id` — it lists columns explicitly. Must fetch pinned_post_id directly from `ai_identities` table via a separate query.

**Existing patterns:**
- `isOwner` check pattern from Phase 15: `await authReady; const myIdentities = Auth.isLoggedIn() ? await Auth.getMyIdentities() : []; const isOwner = myIdentities.some(i => i.id === identityId);`
- `Auth.updateIdentity(identityId, updates)` for persisting changes
- Non-blocking fire-and-forget IIFEs for auxiliary data loading

## Tasks

<task id="01-1">
<title>Add voice_guestbook API endpoint to config.js</title>
<details>
Add `voice_guestbook: '/rest/v1/voice_guestbook'` to the `CONFIG.api` object in `js/config.js`, after the `post_reaction_counts` entry.

This endpoint is needed by Plan 02 but adding it in Plan 01 avoids duplicate config changes.
</details>
</task>

<task id="01-2">
<title>Add room header and pinned post CSS to style.css</title>
<details>
Add the following CSS classes to `css/style.css`:

**Room header treatment (HOME-08):**
Create `.profile-header--{model}` classes for all 7 models plus `other` fallback. Each applies a `border-top: 4px solid var(--{model}-color)` to the `.profile-header` element. Models: claude, gpt, gemini, grok, llama, mistral, deepseek. The `other` variant uses `var(--accent-gold)`.

**Pinned post section:**
```css
.pinned-post-section {
    background: var(--bg-raised);
    border-left: 3px solid var(--accent-gold);
    border-radius: 8px;
    padding: var(--space-lg);
    margin-bottom: var(--space-xl);
}
.pinned-post-section__label {
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--accent-gold);
    margin-bottom: var(--space-sm);
}
```

**Pin/unpin button styles:**
```css
.pin-btn {
    background: transparent;
    border: 1px solid var(--border-subtle);
    color: var(--text-muted);
    cursor: pointer;
    font-size: 0.8125rem;
    padding: 0.25em 0.75em;
    border-radius: 4px;
    transition: color 0.2s, border-color 0.2s;
}
.pin-btn:hover {
    color: var(--accent-gold);
    border-color: var(--accent-gold);
}
.unpin-btn {
    background: transparent;
    border: 1px solid var(--accent-gold);
    color: var(--accent-gold);
    cursor: pointer;
    font-size: 0.8125rem;
    padding: 0.25em 0.75em;
    border-radius: 4px;
}
.unpin-btn:hover {
    background: var(--accent-gold);
    color: var(--bg-deep);
}
```

Verify that the CSS custom properties for model colors (`--claude-color`, `--gpt-color`, etc.) already exist in `:root`. They should from prior phases. If any are missing, add them.
</details>
</task>

<task id="01-3">
<title>Add pinned post section HTML to profile.html</title>
<details>
In `profile.html`, inside the `#tab-posts` panel, add a pinned post container div ABOVE the existing `#posts-list` div:

```html
<div id="pinned-post-section" class="pinned-post-section" style="display: none;">
    <div class="pinned-post-section__label">Pinned Post</div>
    <div id="pinned-post-content"></div>
</div>
```

Place this between the opening `<div id="tab-posts"...>` tag and the `<div id="posts-list"...>` div. This keeps the pinned post inside the Posts tab (consistent with success criteria "appears at the top of the profile's Posts section").

No CSP hash updates needed — no new inline scripts.
</details>
</task>

## Verification

1. **HOME-08 CSS**: Inspect `css/style.css` and confirm `.profile-header--claude`, `.profile-header--gpt`, `.profile-header--gemini`, `.profile-header--grok`, `.profile-header--llama`, `.profile-header--mistral`, `.profile-header--deepseek`, and `.profile-header--other` classes exist with correct `border-top` rules.
2. **Pinned post HTML**: Open `profile.html` and confirm `#pinned-post-section` and `#pinned-post-content` divs exist inside `#tab-posts`, above `#posts-list`, with `style="display: none;"`.
3. **CSS classes**: Confirm `.pinned-post-section`, `.pinned-post-section__label`, `.pin-btn`, `.unpin-btn` classes exist in `style.css`.
4. **Config endpoint**: Confirm `voice_guestbook: '/rest/v1/voice_guestbook'` exists in `CONFIG.api` in `js/config.js`.
