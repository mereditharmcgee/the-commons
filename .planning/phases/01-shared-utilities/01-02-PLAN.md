---
phase: 01-shared-utilities
plan: 02
type: execute
wave: 2
depends_on:
  - 01-01
files_modified:
  - js/home.js
  - js/admin.js
  - js/dashboard.js
  - js/profile.js
  - js/voices.js
autonomous: false
requirements:
  - STRC-01

must_haves:
  truths:
    - "No JS file in js/ contains a local function named getModelClass"
    - "All pages that previously used getModelClass() now call Utils.getModelClass()"
    - "The admin page still renders the correct badge color for posts with model='openai' or model='Google Gemini'"
    - "The home, admin, dashboard, profile, and voices pages visually render model badges with correct colors"
  artifacts:
    - path: "js/home.js"
      provides: "getModelClass call site replaced with Utils.getModelClass"
      contains: "Utils.getModelClass"
    - path: "js/admin.js"
      provides: "local getModelClass function removed and all 4 call sites replaced"
      contains: "Utils.getModelClass"
    - path: "js/dashboard.js"
      provides: "local getModelClass function removed and call site replaced"
      contains: "Utils.getModelClass"
    - path: "js/profile.js"
      provides: "local getModelClass function removed and call sites replaced"
      contains: "Utils.getModelClass"
    - path: "js/voices.js"
      provides: "local getModelClass function removed and call site replaced"
      contains: "Utils.getModelClass"
  key_links:
    - from: "js/home.js line 159"
      to: "js/utils.js Utils.getModelClass()"
      via: "call site replacement: getModelClass(post.model) → Utils.getModelClass(post.model)"
      pattern: "Utils\\.getModelClass"
    - from: "js/admin.js lines 346, 398, 620, 674"
      to: "js/utils.js Utils.getModelClass()"
      via: "4 call sites replaced + local function declaration removed"
      pattern: "Utils\\.getModelClass"
---

<objective>
Remove the 5 local getModelClass() function definitions from home.js, admin.js, dashboard.js, profile.js, and voices.js, and update all call sites to use Utils.getModelClass() instead.

Purpose: Completes STRC-01. After this plan, adding a new AI model to CONFIG.models is a 2-file change (config.js + style.css) instead of a 7-file change.
Output: 5 modified JS files with local getModelClass functions removed and call sites updated to Utils.getModelClass().
</objective>

<execution_context>
@C:/Users/mmcge/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/mmcge/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-shared-utilities/01-CONTEXT.md
@.planning/phases/01-shared-utilities/01-RESEARCH.md
@.planning/phases/01-shared-utilities/01-01-SUMMARY.md

<interfaces>
<!-- Call sites and function locations from codebase audit. Executor should use these directly. -->

**home.js**
- Function definition: lines 18-29 (full `function getModelClass(model) { ... }` block, 12 lines)
- Call site: line 159 — `const modelClass = getModelClass(post.model);`
- Replace call: `const modelClass = Utils.getModelClass(post.model);`

**admin.js**
- Function definition: lines 316-327 (inside IIFE) — includes openai/google aliases (now handled by CONFIG.models)
- Call sites (4 total):
  - line 346 — template literal: `admin-item__model--${getModelClass(post.model)}`
  - line 398 — template literal: `admin-item__model--${getModelClass(item.model)}`
  - line 620 — template literal: `identity-item__model--${getModelClass(identity.model)}`
  - line 674 — `const modelClass = getModelClass(post.model);`
- Replace each with `Utils.getModelClass(...)` using the same argument

**dashboard.js**
- Function definition: lines 178-188 (no null guard — Utils.getModelClass() has the guard, so safe)
- Call site: line 155 — template literal: `model-badge--${getModelClass(identity.model)}`
- Replace call: `model-badge--${Utils.getModelClass(identity.model)}`
- NOTE: Line 155 appears before line 178 in the file. This works now because `function` declarations are hoisted. After replacing with `Utils.getModelClass()`, hoisting is irrelevant — Utils is already loaded by the time dashboard.js runs (utils.js loads first via script tag).

**profile.js**
- Function definition: lines 133-143 (no null guard)
- Call sites (3 total):
  - line 70 — `const modelClass = getModelClass(identity.model);`
  - line 71 — (likely uses modelClass variable)
  - line 73 — (likely uses modelClass variable)
- Replace line 70: `const modelClass = Utils.getModelClass(identity.model);`
- Lines 71 and 73 use `modelClass` variable — no change needed to those lines

**voices.js**
- Function definition: lines 62-72
- Call site: line 31 — `const modelClass = getModelClass(identity.model);`
- Replace call: `const modelClass = Utils.getModelClass(identity.model);`
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove local getModelClass from all 5 JS files</name>
  <files>js/home.js, js/admin.js, js/dashboard.js, js/profile.js, js/voices.js</files>
  <action>
For EACH of the 5 files, perform two operations: (A) remove the local function definition, (B) update all call sites. Do them in this order for each file.

**home.js:**
A. Remove the entire `function getModelClass(model) { ... }` block at lines 18-29 (12 lines including the closing brace). Do not leave blank lines in its place — remove all the whitespace from the removed block too, but keep the blank line separating the next function if one exists.
B. At line 159 (may shift after deletion), change:
   `const modelClass = getModelClass(post.model);`
   to:
   `const modelClass = Utils.getModelClass(post.model);`

**admin.js:**
A. Remove the entire `function getModelClass(model) { ... }` block at lines 316-327 (inside IIFE). Same rule — remove cleanly without leaving orphaned blank lines.
B. Update 4 call sites:
   - `getModelClass(post.model)` → `Utils.getModelClass(post.model)` (appears in two template literals)
   - `getModelClass(item.model)` → `Utils.getModelClass(item.model)` (template literal)
   - `getModelClass(identity.model)` → `Utils.getModelClass(identity.model)` (template literal)
   - `const modelClass = getModelClass(post.model);` → `const modelClass = Utils.getModelClass(post.model);`

**dashboard.js:**
A. Remove the entire `function getModelClass(model) { ... }` block at lines 178-188.
B. Change:
   `model-badge--${getModelClass(identity.model)}`
   to:
   `model-badge--${Utils.getModelClass(identity.model)}`

**profile.js:**
A. Remove the entire `function getModelClass(model) { ... }` block at lines 133-143.
B. Change:
   `const modelClass = getModelClass(identity.model);`
   to:
   `const modelClass = Utils.getModelClass(identity.model);`
   (Lines 71 and 73 reference the `modelClass` variable — they need no changes)

**voices.js:**
A. Remove the entire `function getModelClass(model) { ... }` block at lines 62-72.
B. Change:
   `const modelClass = getModelClass(identity.model);`
   to:
   `const modelClass = Utils.getModelClass(identity.model);`

**IMPORTANT:** Do NOT touch any API call patterns in home.js (the `Utils.get('posts', ...)` calls are a pre-existing quirk unrelated to this phase). Only modify the getModelClass function definition and its call sites.

After all 5 files are edited, run this verification command:
```bash
grep -rn "function getModelClass" js/
```
This MUST return zero results. If any file still has the function definition, fix it before moving on.
  </action>
  <verify>
Run in project root (Git Bash):
```bash
grep -rn "function getModelClass" js/
grep -rn "getModelClass(" js/ | grep -v "Utils\.getModelClass"
```
Both commands must return zero results. The first checks for remaining function definitions. The second checks for call sites that weren't updated to Utils.getModelClass.

Also verify no syntax breaks:
```bash
node --check js/utils.js && echo "utils.js OK"
```
  </verify>
  <done>All 5 local getModelClass function definitions are removed. All call sites use Utils.getModelClass(). No file in js/ contains a bare getModelClass call (only Utils.getModelClass calls exist). utils.js passes Node syntax check.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Visual verification of model badge colors on live site</name>
  <action>Push the 5 modified JS files to GitHub (git add js/home.js js/admin.js js/dashboard.js js/profile.js js/voices.js && git commit -m "refactor(01): migrate local getModelClass to Utils.getModelClass" && git push origin main), then wait for GitHub Pages to deploy (typically 1-2 minutes). Then pause for human verification of the live site.</action>
  <what-built>Migrated all 5 JS files to use Utils.getModelClass(). Local getModelClass function definitions removed from home.js, admin.js, dashboard.js, profile.js, voices.js. All call sites updated.</what-built>
  <how-to-verify>
Open https://jointhecommons.space/ and check these pages while logged in (or logged out):

1. **Homepage** (/) — Scroll to the recent activity feed. Posts should show colored model badges (gold for Claude, green for GPT, purple for Gemini, etc.). No badge should be missing or grey/unstyled.

2. **Voices page** (/voices.html) — Every identity card should show the model badge with the correct color. Look for any badge showing as unstyled/plain text.

3. **Profile page** — Click any identity from the Voices page. The profile page should show the model badge with correct color in the header.

4. **Dashboard** (/dashboard.html, requires login) — Under "Your Identities", each identity card should show the model badge with correct color.

5. **Admin** (/admin.html, requires admin login) — Posts and identities should show colored model badges. In particular, verify that any post with model="openai" shows the green GPT badge (not grey), and any post with model containing "google" shows the purple Gemini badge (not grey).

If all model badges appear with correct colors on all pages, type "approved".
If any page shows missing or wrong-color badges, describe which page and which model is broken.
  </how-to-verify>
  <resume-signal>Type "approved" to confirm model badges are correct, or describe any badge color issues found.</resume-signal>
</task>

</tasks>

<verification>
After Task 1 auto completes and before checkpoint:
```bash
grep -rn "function getModelClass" js/
```
Must return zero results.

```bash
grep -rn "getModelClass(" js/ | grep -v "Utils\.getModelClass"
```
Must return zero results.

After checkpoint passes: Phase 1 is complete. STRC-01 and STRC-10 are satisfied.
</verification>

<success_criteria>
- No file in js/ contains a `function getModelClass` declaration
- No file in js/ contains a bare `getModelClass(` call (only `Utils.getModelClass(` calls exist)
- The site renders model badges with correct colors on homepage, voices, profile, dashboard, and admin pages
- Posts stored with model='openai' or model containing 'google' render with the correct gpt/gemini badge color (via aliases added to CONFIG.models in Plan 01)
</success_criteria>

<output>
After completion, create `.planning/phases/01-shared-utilities/01-02-SUMMARY.md` using the summary template at `@C:/Users/mmcge/.claude/get-shit-done/templates/summary.md`.
</output>
