---
phase: 01-shared-utilities
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - js/utils.js
  - js/config.js
  - css/style.css
autonomous: true
requirements:
  - STRC-01
  - STRC-10

must_haves:
  truths:
    - "Utils.getModelClass('claude') returns 'claude'"
    - "Utils.getModelClass('openai') returns 'gpt' (alias preserved)"
    - "Utils.getModelClass('google') returns 'gemini' (alias preserved)"
    - "Utils.getModelClass(null) returns 'other' (null guard works)"
    - "Utils.getModelClass('unknownmodel') returns 'other' (silent fallback)"
    - "Utils.validate() returns false and renders a .form-error div below the invalid field"
    - "Utils.validate() returns true when all rules pass"
    - "Inline form error fields get a red border via .form-input--error / .form-textarea--error / .form-select--error"
  artifacts:
    - path: "js/utils.js"
      provides: "Utils.getModelClass() and Utils.validate() methods"
      contains: "getModelClass"
    - path: "js/config.js"
      provides: "openai and google alias entries in CONFIG.models"
      contains: "'openai'"
    - path: "css/style.css"
      provides: ".form-error, .form-input--error, .form-textarea--error, .form-select--error classes"
      contains: ".form-error"
  key_links:
    - from: "js/utils.js Utils.getModelClass()"
      to: "js/utils.js Utils.getModelInfo()"
      via: "delegates to getModelInfo then returns .class"
      pattern: "getModelInfo\\("
    - from: "js/utils.js Utils.getModelInfo()"
      to: "js/config.js CONFIG.models"
      via: "iterates Object.entries(CONFIG.models)"
      pattern: "CONFIG\\.models"
    - from: "js/utils.js Utils.validate()"
      to: "css/style.css .form-error"
      via: "createElement('div') with className 'form-error'"
      pattern: "form-error"
---

<objective>
Add Utils.getModelClass() and Utils.validate() to js/utils.js, add openai/google aliases to js/config.js, and add form validation error CSS to css/style.css.

Purpose: These are the foundational helpers that all pages will use in Phase 2+. getModelClass() eliminates 5 local duplicates (migrated in Plan 02). validate() provides consistent inline form validation across the site.
Output: Three modified files: js/utils.js (two new methods), js/config.js (two new alias entries), css/style.css (four new CSS rules).
</objective>

<execution_context>
@C:/Users/mmcge/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/mmcge/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-shared-utilities/01-CONTEXT.md
@.planning/phases/01-shared-utilities/01-RESEARCH.md

<interfaces>
<!-- Key interfaces the executor needs. Extracted from codebase. No codebase exploration needed. -->

From js/utils.js (lines 284-299) — existing getModelInfo that getModelClass wraps:
```js
getModelInfo(modelName) {
    const normalized = modelName.toLowerCase().trim();
    for (const [key, value] of Object.entries(CONFIG.models)) {
        if (key !== 'default' && normalized.includes(key)) {
            return value;
        }
    }
    return { name: modelName, class: CONFIG.models.default.class };
},
```

From js/config.js (lines 47-59) — CONFIG.models current structure:
```js
models: {
    'claude':    { name: 'Claude',    class: 'claude'   },
    'gpt':       { name: 'GPT',       class: 'gpt'      },
    'gpt-4':     { name: 'GPT-4',     class: 'gpt'      },
    'gpt-4o':    { name: 'GPT-4o',    class: 'gpt'      },
    'chatgpt':   { name: 'ChatGPT',   class: 'gpt'      },
    'gemini':    { name: 'Gemini',    class: 'gemini'   },
    'grok':      { name: 'Grok',      class: 'grok'     },
    'llama':     { name: 'Llama',     class: 'llama'    },
    'mistral':   { name: 'Mistral',   class: 'mistral'  },
    'deepseek':  { name: 'DeepSeek',  class: 'deepseek' },
    'default':   { name: 'AI',        class: 'other'    }
}
```

From css/style.css — existing form classes to build error states on:
```css
.form-input, .form-select, .form-textarea {
    border: 1px solid var(--border-medium);
    border-radius: 6px;
    transition: all var(--transition-fast);
}
.form-input:focus, .form-select:focus, .form-textarea:focus {
    border-color: var(--accent-gold);
    box-shadow: 0 0 0 3px var(--accent-gold-glow);
}
.form-help {
    font-size: 0.8125rem;  /* Target size for .form-error too */
    margin-top: var(--space-xs);
}
.alert--error { color: #f87171; }  /* Target color for .form-error */
```
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Utils.getModelClass() and openai/google aliases</name>
  <files>js/utils.js, js/config.js</files>
  <action>
**In js/config.js:** Add two alias entries to CONFIG.models, immediately before the `'default'` entry. These preserve the behavior from admin.js that handles 'openai' and 'google' as model name variants:

```js
'openai':  { name: 'GPT',    class: 'gpt'    },
'google':  { name: 'Gemini', class: 'gemini' },
```

After the addition, the CONFIG.models block should read (in order): claude, gpt, gpt-4, gpt-4o, chatgpt, gemini, grok, llama, mistral, deepseek, openai, google, default.

**In js/utils.js:** Add the getModelClass() method immediately after the closing brace of getModelInfo() (around line 299). Add it as a new method on the Utils object, following the same comma-separated pattern as all other methods:

```js
/**
 * Get the CSS class suffix for a model name.
 * Derived from CONFIG.models — adding a new model to CONFIG
 * automatically makes it available here.
 * @param {string} model - The model name (e.g. "Claude", "GPT-4")
 * @returns {string} CSS class suffix (e.g. "claude", "gpt", "other")
 */
getModelClass(model) {
    if (!model) return CONFIG.models.default.class;
    return this.getModelInfo(model).class;
},
```

Do NOT modify getModelInfo() itself. Do NOT add any console.warn or logging anywhere.
  </action>
  <verify>
In a Git Bash shell in the project root, run:
```bash
grep -n "getModelClass" js/utils.js
grep -n "openai.*gpt\|google.*gemini" js/config.js
```
First command should return one result (the new method definition). Second should return two results (the alias entries).
  </verify>
  <done>js/utils.js contains Utils.getModelClass() as a thin wrapper over Utils.getModelInfo(). js/config.js contains 'openai' and 'google' entries in CONFIG.models both pointing to their correct class values.</done>
</task>

<task type="auto">
  <name>Task 2: Add Utils.validate() and form error CSS</name>
  <files>js/utils.js, css/style.css</files>
  <action>
**In css/style.css:** Find the `.form-help` rule (around line 881). Add the following CSS block immediately after the closing brace of `.form-help` (or its associated block). This uses the same error red as `.alert--error` (#f87171) and the same font-size/margin as `.form-help`:

```css
/* Inline form field validation errors */
.form-error {
    font-size: 0.8125rem;
    color: #f87171;
    margin-top: var(--space-xs);
}

.form-input--error,
.form-select--error,
.form-textarea--error {
    border-color: #f87171 !important;
}

.form-input--error:focus,
.form-select--error:focus,
.form-textarea--error:focus {
    border-color: #f87171 !important;
    box-shadow: 0 0 0 3px rgba(248, 113, 113, 0.15) !important;
}
```

**In js/utils.js:** Add the validate() method immediately after the closing brace of getModelClass() (the method added in Task 1). The method should be on the Utils object (comma-separated like all others):

```js
/**
 * Validate form fields against rules. Renders inline error messages
 * below each invalid field. Returns true if all rules pass.
 * Call on form submit before making any API request.
 *
 * @param {Array<{id: string, label: string, rules: Object}>} fields
 *   - id: DOM element ID of the field
 *   - label: human-readable field name (used in error messages)
 *   - rules.required: boolean — field must be non-empty
 *   - rules.minLength: number — minimum character count
 *   - rules.maxLength: number — maximum character count
 *   - rules.pattern: RegExp — value must match
 *   - rules.patternMessage: string — custom message on pattern failure
 *   - rules.custom: function(value) => string|null — return error string or null
 * @returns {boolean} true if all fields pass all rules, false if any fail
 */
validate(fields) {
    let isValid = true;

    // Clear previous errors
    fields.forEach(({ id }) => {
        const el = document.getElementById(id);
        if (!el) return;
        el.classList.remove('form-input--error', 'form-textarea--error', 'form-select--error');
        const existing = el.parentElement ? el.parentElement.querySelector('.form-error') : null;
        if (existing) existing.remove();
    });

    fields.forEach(({ id, label, rules = {} }) => {
        const el = document.getElementById(id);
        if (!el) return;
        const value = el.value.trim();
        let errorMsg = null;

        if (rules.required && !value) {
            errorMsg = `${label} is required.`;
        } else if (rules.minLength && value.length < rules.minLength) {
            errorMsg = `${label} must be at least ${rules.minLength} characters.`;
        } else if (rules.maxLength && value.length > rules.maxLength) {
            errorMsg = `${label} must be ${rules.maxLength} characters or fewer.`;
        } else if (rules.pattern && !rules.pattern.test(value)) {
            errorMsg = rules.patternMessage || `${label} format is invalid.`;
        } else if (rules.custom) {
            errorMsg = rules.custom(value);
        }

        if (errorMsg) {
            isValid = false;
            const tag = el.tagName.toLowerCase();
            if (tag === 'textarea') {
                el.classList.add('form-textarea--error');
            } else if (tag === 'select') {
                el.classList.add('form-select--error');
            } else {
                el.classList.add('form-input--error');
            }
            const errEl = document.createElement('div');
            errEl.className = 'form-error';
            errEl.textContent = errorMsg;
            if (el.parentElement) el.parentElement.appendChild(errEl);
        }
    });

    return isValid;
},
```

Do NOT use alert() anywhere in this method. Do NOT add a validation summary box at the top — errors are inline per field only.
  </action>
  <verify>
In a Git Bash shell in the project root, run:
```bash
grep -n "validate(" js/utils.js
grep -n "\.form-error" css/style.css
grep -n "form-input--error" css/style.css
```
All three should return at least one result. Also verify js/utils.js has no syntax errors by checking the file ends correctly (the Utils object must still close properly).
  </verify>
  <done>js/utils.js contains Utils.validate() with support for required, minLength, maxLength, pattern, and custom rules. css/style.css contains .form-error (red text, small font below field) and .form-input--error / .form-textarea--error / .form-select--error (red border) classes. The Utils object is syntactically valid.</done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `grep -n "getModelClass\|validate(" js/utils.js` — should show both methods defined exactly once each
2. `grep -n "openai\|google" js/config.js` — should show two new alias entries
3. `grep -n "form-error\|form-input--error" css/style.css` — should show the new CSS classes
4. Open `js/utils.js` in an editor and confirm the Utils object still closes with `};` at the end (no unclosed braces from edits)
</verification>

<success_criteria>
- Utils.getModelClass() exists in js/utils.js as a method on the Utils object
- getModelClass() returns CONFIG.models.default.class for null/undefined input
- getModelClass() delegates to getModelInfo() for all other input — does not contain its own if-chain
- CONFIG.models in js/config.js contains 'openai' → gpt and 'google' → gemini entries
- Utils.validate() exists in js/utils.js with all five rule types (required, minLength, maxLength, pattern, custom)
- validate() renders .form-error divs inline below invalid fields
- validate() adds appropriate --error modifier classes to the invalid field element
- css/style.css contains all four new CSS rules with correct error red color (#f87171)
- js/utils.js has no syntax errors (Utils object correctly formed)
</success_criteria>

<output>
After completion, create `.planning/phases/01-shared-utilities/01-01-SUMMARY.md` using the summary template at `@C:/Users/mmcge/.claude/get-shit-done/templates/summary.md`.
</output>
