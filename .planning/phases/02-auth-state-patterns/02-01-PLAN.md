---
phase: 02-auth-state-patterns
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [js/utils.js, css/style.css]
autonomous: true
requirements: [STRC-04, STRC-05, STRC-06]

must_haves:
  truths:
    - "Utils.showError() renders a retry button when onRetry callback is provided"
    - "Utils.showError() renders a muted technical hint when technicalDetail is provided"
    - "Utils.showEmpty() renders a CTA link-button when ctaLabel and ctaHref are provided"
    - "Existing callers of showError() and showEmpty() with old signatures still work unchanged"
  artifacts:
    - path: "js/utils.js"
      provides: "Upgraded showError and showEmpty helpers"
      contains: "onRetry"
    - path: "css/style.css"
      provides: "CSS for retry button, technical hint, empty state CTA, grid-spanning empty state"
      contains: "alert__retry-btn"
  key_links:
    - from: "js/utils.js showError"
      to: "css/style.css .alert__retry-btn"
      via: "classList and innerHTML"
      pattern: "alert__retry-btn"
    - from: "js/utils.js showEmpty"
      to: "css/style.css .empty-state__cta"
      via: "classList and innerHTML"
      pattern: "empty-state__cta"
---

<objective>
Upgrade Utils.showError() and Utils.showEmpty() to support retry buttons, technical hints, CTA links, and warm messaging — plus add the CSS classes these new features need.

Purpose: These upgraded helpers are the foundation for all page-by-page state pattern work in Plans 02 and 03. Without the retry button and CTA support, every page task would need ad-hoc HTML.

Output: Updated js/utils.js with backward-compatible upgraded signatures; updated css/style.css with 4 new CSS rules.
</objective>

<execution_context>
@C:/Users/mmcge/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/mmcge/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-auth-state-patterns/02-RESEARCH.md

<interfaces>
<!-- Current Utils.showError signature (js/utils.js ~line 497) -->
showError(container, message = 'Something went wrong') {
    if (typeof container === 'string') { container = document.querySelector(container); }
    if (!container) return;
    container.innerHTML = `<div class="alert alert--error">${this.escapeHtml(message)}</div>`;
},

<!-- Current Utils.showEmpty signature (js/utils.js ~line 513) -->
showEmpty(container, title = 'Nothing here yet', text = '') {
    if (typeof container === 'string') { container = document.querySelector(container); }
    if (!container) return;
    container.innerHTML = `
        <div class="empty-state">
            <div class="empty-state__icon">◯</div>
            <div class="empty-state__title">${this.escapeHtml(title)}</div>
            ${text ? `<div class="empty-state__text">${this.escapeHtml(text)}</div>` : ''}
        </div>
    `;
},

<!-- Existing CSS classes (already in style.css): -->
<!-- .alert { padding: var(--space-md) var(--space-lg); border-radius: 6px; margin-bottom: var(--space-lg); font-size: 0.9375rem; } -->
<!-- .alert--error { background: rgba(248, 113, 113, 0.1); border: 1px solid rgba(248, 113, 113, 0.3); color: #f87171; } -->
<!-- .empty-state { text-align: center; padding: var(--space-3xl) var(--space-xl); color: var(--text-muted); } -->
<!-- .btn { display: inline-flex; ... } -->
<!-- .btn--primary { background: var(--accent-gold); color: var(--bg-deep); } -->
<!-- .btn--small { padding: var(--space-xs) var(--space-sm); font-size: 0.8125rem; } -->
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Upgrade Utils.showError() and Utils.showEmpty() signatures</name>
  <files>js/utils.js</files>
  <action>
  Upgrade both helper methods in js/utils.js with backward-compatible new signatures. All existing callers that pass (container, message) or (container, title, text) must continue working without changes.

  **showError upgrade:**
  Replace the current showError method (~line 497) with:

  ```javascript
  showError(container, message = 'Something went wrong. Want to try again?', { onRetry, technicalDetail } = {}) {
      if (typeof container === 'string') {
          container = document.querySelector(container);
      }
      if (!container) return;
      container.innerHTML = `
          <div class="alert alert--error">
              <p class="alert__message">${this.escapeHtml(message)}</p>
              ${onRetry ? '<button class="alert__retry-btn btn btn--small">Try again</button>' : ''}
              ${technicalDetail ? `<p class="alert__technical">${this.escapeHtml(technicalDetail)}</p>` : ''}
          </div>
      `;
      if (onRetry) {
          container.querySelector('.alert__retry-btn').addEventListener('click', onRetry);
      }
  },
  ```

  Key points:
  - Third parameter is an options object with `onRetry` (function) and `technicalDetail` (string)
  - Default message changed to warm tone per user decision
  - Retry button uses `.btn .btn--small` classes (already exist in CSS)
  - Event listener wired AFTER innerHTML (not inline onclick)
  - `technicalDetail` renders as muted fine print below the message
  - `this.escapeHtml()` applied to both message and technicalDetail

  **showEmpty upgrade:**
  Replace the current showEmpty method (~line 513) with:

  ```javascript
  showEmpty(container, title = 'Nothing here yet', text = '', { ctaLabel, ctaHref } = {}) {
      if (typeof container === 'string') {
          container = document.querySelector(container);
      }
      if (!container) return;
      container.innerHTML = `
          <div class="empty-state">
              <div class="empty-state__icon">&#9711;</div>
              <div class="empty-state__title">${this.escapeHtml(title)}</div>
              ${text ? `<div class="empty-state__text">${this.escapeHtml(text)}</div>` : ''}
              ${ctaLabel && ctaHref ? `<a href="${this.escapeHtml(ctaHref)}" class="empty-state__cta btn btn--primary">${this.escapeHtml(ctaLabel)}</a>` : ''}
          </div>
      `;
  },
  ```

  Key points:
  - Fourth parameter is an options object with `ctaLabel` (string) and `ctaHref` (string)
  - CTA only renders when BOTH ctaLabel and ctaHref are provided
  - Uses `.btn .btn--primary` classes (already exist)
  - `this.escapeHtml()` on all dynamic values including href

  **Update JSDoc comments** above both methods to document the new parameters.
  </action>
  <verify>
    <automated>cd C:/Users/mmcge/the-commons && grep -n "onRetry" js/utils.js && grep -n "ctaLabel" js/utils.js && grep -n "alert__retry-btn" js/utils.js && grep -n "empty-state__cta" js/utils.js</automated>
  </verify>
  <done>
  - Utils.showError(container, message, { onRetry, technicalDetail }) renders retry button when onRetry provided, muted technical text when technicalDetail provided
  - Utils.showEmpty(container, title, text, { ctaLabel, ctaHref }) renders CTA link-button when both provided
  - Old callers (2-arg showError, 3-arg showEmpty) still work because new params have defaults
  </done>
</task>

<task type="auto">
  <name>Task 2: Add CSS classes for retry button, technical hint, empty state CTA, and grid-spanning empty state</name>
  <files>css/style.css</files>
  <action>
  Add four new CSS rules to css/style.css. Place them in the correct sections:

  **In the ALERTS section (after .alert--info rule, around line 1054):**

  ```css
  .alert__message {
      margin: 0 0 var(--space-sm) 0;
  }

  .alert__retry-btn {
      margin-top: var(--space-sm);
  }

  .alert__technical {
      margin: var(--space-sm) 0 0 0;
      font-size: 0.8rem;
      opacity: 0.6;
  }
  ```

  **In the EMPTY STATE section (after .empty-state__text rule, around line 813):**

  ```css
  .empty-state__cta {
      margin-top: var(--space-lg);
      text-decoration: none;
  }
  ```

  Also add a grid-spanning rule so that empty states render correctly inside CSS grid containers (like postcards and voices):

  ```css
  /* Grid containers: empty state spans all columns */
  .empty-state {
      grid-column: 1 / -1;
  }
  ```

  This can be added directly to the existing `.empty-state` rule (line 792) by appending `grid-column: 1 / -1;` to the existing properties. This is safe because `grid-column` is ignored in non-grid contexts.

  Key points:
  - `.alert__message` uses `<p>` so needs margin reset (0 0 var(--space-sm) 0) to avoid default p margins
  - `.alert__technical` is subtle — 0.8rem size, 0.6 opacity for muted appearance
  - `.alert__retry-btn` gets margin-top spacing; button styling comes from .btn .btn--small
  - `.empty-state__cta` gets margin-top and removes text-decoration since it's an <a> tag; styling comes from .btn .btn--primary
  - `grid-column: 1 / -1` on `.empty-state` is safe in non-grid contexts (ignored by flex/block)
  </action>
  <verify>
    <automated>cd C:/Users/mmcge/the-commons && grep -n "alert__retry-btn\|alert__message\|alert__technical\|empty-state__cta\|grid-column" css/style.css</automated>
  </verify>
  <done>
  - .alert__message, .alert__retry-btn, .alert__technical classes exist in style.css
  - .empty-state__cta class exists in style.css
  - .empty-state has grid-column: 1 / -1 so it spans full width in grid containers
  - No existing styles broken (all additions, no modifications to existing rules except adding one property to .empty-state)
  </done>
</task>

</tasks>

<verification>
1. `grep -c "onRetry\|ctaLabel\|alert__retry-btn\|empty-state__cta" js/utils.js` returns 4+ matches
2. `grep -c "alert__retry-btn\|alert__message\|alert__technical\|empty-state__cta" css/style.css` returns 4+ matches
3. Existing pages that already use Utils.showError() and Utils.showEmpty() (discussions.js, discussion.js, reading-room.js) still render correctly — no visual regression
</verification>

<success_criteria>
- Utils.showError() accepts optional { onRetry, technicalDetail } and renders retry button + muted hint
- Utils.showEmpty() accepts optional { ctaLabel, ctaHref } and renders CTA link-button
- CSS classes .alert__message, .alert__retry-btn, .alert__technical, .empty-state__cta exist
- .empty-state spans grid columns in grid contexts
- All existing callers of showError/showEmpty work without modification
</success_criteria>

<output>
After completion, create `.planning/phases/02-auth-state-patterns/02-01-SUMMARY.md`
</output>
