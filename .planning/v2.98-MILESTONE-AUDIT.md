---
milestone: v2.98
audited: 2026-02-28
status: tech_debt
scores:
  requirements: 28/28
  phases: 8/8
  integration: 18/18
  flows: 7/7
gaps:
  requirements: []
  integration: []
  flows: []
tech_debt:
  - phase: 04-xss-prevention
    items:
      - "SECR-02/SECR-03 checkboxes unchecked in REQUIREMENTS.md — DOMPurify loaded and Utils.sanitizeHtml() wrapper added, but never called by application code. Infrastructure deployed, not consumed."
  - phase: 01-shared-utilities
    items:
      - "STRC-10 Utils.validate() helper added but never called by any form handler. Infrastructure deployed, not consumed."
  - phase: 07-profile-data-integrity
    items:
      - "pc.format concatenated unescaped into CSS class attribute in profile.js line 335. No security impact (CSS class context), but technically non-compliant with PROF-04 literal text."
  - phase: 01-shared-utilities
    items:
      - "Duplicate .form-error CSS rule in style.css (line 894 and line 1342). No visual breakage."
  - phase: bookkeeping
    items:
      - "REQUIREMENTS.md traceability table shows Pending for SECR-07, PROF-01, PROF-03, PROF-04 despite being complete"
      - "REQUIREMENTS.md checkboxes unchecked for SECR-02, SECR-03 despite infrastructure being deployed"
---

# Milestone v2.98 Audit Report

**Milestone:** v2.98 — Foundation Hardening
**Audited:** 2026-02-28
**Status:** tech_debt (all requirements met, accumulated debt needs review)

## Scores

| Dimension | Score | Status |
|-----------|-------|--------|
| Requirements | 28/28 | All satisfied |
| Phases | 8/8 | All passed verification |
| Integration | 18/18 | All exports wired |
| E2E Flows | 7/7 | All complete |

## Phase Verification Summary

| Phase | Name | Verification Status | Notes |
|-------|------|-------------------|-------|
| 1 | Shared Utilities | verified | Clean pass |
| 2 | Auth State Patterns | passed | Re-verified after gap closure |
| 3 | Dead Code & Links | passed | Clean pass |
| 4 | XSS Prevention | passed | SECR-02/03 bookkeeping noted |
| 5 | Dependency Security | passed | Clean pass |
| 6 | Auth Security | passed | Human-approved RLS audit |
| 7 | Profile Data Integrity | passed | Minor pc.format gap noted |
| 8 | Profile UX | human_needed→approved | All code checks passed |

## Requirements Coverage (3-Source Cross-Reference)

### Structural Consistency (STRC-01 through STRC-10)

| REQ-ID | Checkbox | Traceability | Verification | Integration | Final Status |
|--------|----------|-------------|--------------|-------------|-------------|
| STRC-01 | [x] | Complete | Phase 1 passed | Wired (7 consumers) | satisfied |
| STRC-02 | [x] | Complete | Phase 2 passed | Wired | satisfied |
| STRC-03 | [x] | Complete | Phase 2 passed | Wired | satisfied |
| STRC-04 | [x] | Complete | Phase 2 passed | Wired (7 consumers) | satisfied |
| STRC-05 | [x] | Complete | Phase 2 passed | Wired | satisfied |
| STRC-06 | [x] | Complete | Phase 2 passed | Wired | satisfied |
| STRC-07 | [x] | Complete | Phase 3 passed | Self-contained | satisfied |
| STRC-08 | [x] | Complete | Phase 3 passed | Wired | satisfied |
| STRC-09 | [x] | Complete | Phase 3 passed | Self-contained | satisfied |
| STRC-10 | [x] | Complete | Phase 1 passed | Orphaned (0 callers) | satisfied* |

*STRC-10: Requirement text says "helper added" — helper IS added. No form has adopted it yet (tech debt).

### Security & Safety (SECR-01 through SECR-10)

| REQ-ID | Checkbox | Traceability | Verification | Integration | Final Status |
|--------|----------|-------------|--------------|-------------|-------------|
| SECR-01 | [x] | Complete | Phase 4 passed | Wired | satisfied |
| SECR-02 | [ ] | Pending | Phase 4 passed | Partial (loaded, not called) | satisfied* |
| SECR-03 | [ ] | Pending | Phase 4 passed | Partial (defined, not called) | satisfied* |
| SECR-04 | [x] | Complete | Phase 5 passed | Wired | satisfied |
| SECR-05 | [x] | Complete | Phase 5 passed | Wired (27 pages) | satisfied |
| SECR-06 | [x] | Complete | Phase 5 passed | Wired (91 links) | satisfied |
| SECR-07 | [x] | Pending | Phase 6 passed | Documentation artifact | satisfied |
| SECR-08 | [x] | Complete | Phase 6 passed | Wired | satisfied |
| SECR-09 | [x] | Complete | Phase 6 passed | Wired | satisfied |
| SECR-10 | [x] | Complete | Phase 6 passed | Wired | satisfied |

*SECR-02: Requirement says "loaded via CDN with SRI hash" — DOMPurify IS loaded on 4 pages with SRI. Never called by app code.
*SECR-03: Requirement says "wrapper added to utils.js" — wrapper IS added with DOMPurify fallback. Zero call sites.

### Profile & Identity (PROF-01 through PROF-08)

| REQ-ID | Checkbox | Traceability | Verification | Integration | Final Status |
|--------|----------|-------------|--------------|-------------|-------------|
| PROF-01 | [x] | Pending | Phase 7 passed | Wired (SQL patch dependent) | satisfied |
| PROF-02 | [x] | Complete | Phase 7 passed | Wired | satisfied |
| PROF-03 | [x] | Pending | Phase 7 passed | Wired | satisfied |
| PROF-04 | [x] | Pending | Phase 7 passed | Wired (minor gap) | satisfied |
| PROF-05 | [x] | Complete | Phase 8 approved | Wired | satisfied |
| PROF-06 | [x] | Complete | Phase 8 approved | Self-contained | satisfied |
| PROF-07 | [x] | Complete | Phase 8 approved | Wired (SQL confirmed) | satisfied |
| PROF-08 | [x] | Complete | Phase 8 approved | Wired | satisfied |

### Out of Scope for This Milestone

AGNT-01 through AGNT-09 are mapped to Phases 9-10 in REQUIREMENTS.md traceability table. These phases do not exist in the current milestone roadmap (phases 1-8 only). These requirements are NOT evaluated in this audit.

## Integration Check Results

**Cross-phase wiring:** All 8 phases connected as designed.
- Phase 1 utilities consumed by Phases 2, 4, 7, 8
- Phase 2 state helpers consumed by all data-fetching pages
- Phase 3 HTML fixes enabled Phase 4 (admin.html needed utils.js)
- Phase 5 CSP required Phase 6 hash updates
- Phase 7 view column consumed by Phase 8 sort logic

**Orphaned exports (2):**
1. `Utils.validate()` — defined, CSS wired, zero callers
2. `Utils.sanitizeHtml()` — defined with DOMPurify fallback, zero callers

**E2E Flows (7/7 complete):**
1. Anonymous browse → voices → profile → last-active, discussions, facilitator
2. Anonymous read discussion → escapeHtml-escaped content, CSP enforced
3. Facilitator login → dashboard redirect on expired session
4. Expired magic link → otp_expired detection, clear redirect
5. Password reset with stale link → session check, form hidden
6. Submit post → char counter live, draft saved, auth guard
7. Admin panel → Utils.getModelClass(), profile links correct

**Conditional flows (2, graceful degradation confirmed):**
1. Profile last-active (PROF-01) — falls back to created_at if SQL patch not applied
2. Voices last-active sort (PROF-08) — nulls pushed to bottom, labels hidden if no data

## Tech Debt Summary

| Area | Item | Severity | Phase |
|------|------|----------|-------|
| Unused infrastructure | Utils.validate() defined but never called | Low | 1 |
| Unused infrastructure | Utils.sanitizeHtml() / DOMPurify loaded but never called | Medium | 4 |
| Minor code gap | pc.format unescaped in CSS class context (profile.js:335) | Low | 7 |
| Duplicate CSS | .form-error rule defined twice in style.css | Low | 1 |
| Bookkeeping | Traceability table Pending for 4 complete requirements | Low | All |
| Bookkeeping | SECR-02/03 checkboxes unchecked despite deployment | Low | 4 |

**Total:** 6 items across 4 phases. No blockers. No runtime failures.

---

*Audit generated: 2026-02-28*
*Milestone: v2.98 — Foundation Hardening*
